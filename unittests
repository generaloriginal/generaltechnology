ype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Class Drill (Units 1–6)</title>
  <style>
    :root {
      --bg: #000;
      --fg: #fff;
      --muted: rgba(255,255,255,.7);
      --good: rgba(0, 255, 160, .35);
      --bad: rgba(255, 80, 80, .35);
      --ring: rgba(255,255,255,.18);
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius: 16px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: var(--font);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 28px 16px;
    }
    .app {
      width: min(980px, 100%);
      display: grid;
      gap: 16px;
      align-content: start;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }
    h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: .2px;
    }
    .sub {
      margin-top: 6px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .panel {
      background: rgba(255,255,255,.06);
      border: 1px solid var(--ring);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 860px) {
      .controls { grid-template-columns: 1fr 1fr; }
    }
    label {
      display: grid;
      gap: 6px;
      font-size: 12px;
      color: var(--muted);
    }
    select, button {
      font-family: inherit;
      font-size: 14px;
      color: var(--fg);
    }
    select{
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--ring);
      outline: none;
    }
    select:focus, button:focus {
      box-shadow: 0 0 0 3px rgba(255,255,255,.15);
      border-color: rgba(255,255,255,.3);
    }
    .checkrow {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--ring);
      height: 42px;
      user-select: none;
    }
    .checkrow input { transform: scale(1.05); }
    .btnrow {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 12px;
    }
    button {
      border: 1px solid var(--ring);
      background: rgba(255,255,255,.08);
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      transition: transform .06s ease, background .12s ease, border-color .12s ease;
    }
    button:hover { background: rgba(255,255,255,.12); }
    button:active { transform: translateY(1px); }
    button.primary {
      background: rgba(255,255,255,.16);
      border-color: rgba(255,255,255,.28);
      font-weight: 650;
    }
    button.ghost { background: transparent; }
    button.danger { background: rgba(255,80,80,.14); border-color: rgba(255,80,80,.25); }
    button:disabled { opacity: .55; cursor: not-allowed; }

    .stage {
      padding: 22px 18px;
      min-height: 360px;
      display: grid;
      gap: 14px;
    }
    .meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      color: var(--muted);
      font-size: 13px;
    }
    .pill {
      border: 1px solid var(--ring);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-size: 12px;
      display: inline-flex;
      gap: 8px;
      align-items: center;
      white-space: nowrap;
    }
    .question {
      font-size: clamp(22px, 3.2vw, 34px);
      line-height: 1.2;
      font-weight: 800;
      letter-spacing: .2px;
      margin: 4px 0 0;
      text-align: center;
      padding: 18px 8px 10px;
    }
    .hint {
      text-align: center;
      color: var(--muted);
      margin-top: -6px;
      font-size: 13px;
      line-height: 1.35;
    }
    .options {
      display: grid;
      gap: 10px;
      justify-items: center;
      margin-top: 6px;
    }
    .opt {
      width: min(420px, 100%);
      text-align: center;
      padding: 14px 14px;
      border-radius: 14px;
      background: rgba(255,255,255,.08);
      border: 1px solid var(--ring);
      font-size: 18px;
      font-weight: 650;
    }
    .opt.correct { background: var(--good); border-color: rgba(0,255,160,.45); }
    .opt.wrong   { background: var(--bad);  border-color: rgba(255,80,80,.55); }
    .feedback {
      text-align: center;
      font-size: 14px;
      color: var(--muted);
      min-height: 20px;
    }
    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 4px;
    }
    .score {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      color: var(--muted);
      border: 1px solid var(--ring);
      background: rgba(255,255,255,.04);
      padding: 4px 7px;
      border-radius: 8px;
    }
    .small {
      font-size: 12px;
      color: var(--muted);
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div>
        <h1>Fast Class Drill (Units 1–6)</h1>
        <div class="sub">
          Teacher-led rapid practice. No logins. Black screen + big text + choices.<br/>
          Tip: Press <span class="kbd">1</span> <span class="kbd">2</span> <span class="kbd">3</span> <span class="kbd">4</span> to answer.
        </div>
      </div>
      <div class="pill" id="datasetInfo">Loading…</div>
    </header>

    <section class="panel">
      <div class="controls">
        <label>
          Unit
          <select id="unitSelect"></select>
        </label>

        <label>
          Mode
          <select id="modeSelect">
            <option value="mixed">Mixed (Grammar + Vocab + Pronunciation)</option>
            <option value="grammar">Grammar</option>
            <option value="vocab">Vocabulary</option>
            <option value="pron">Pronunciation</option>
          </select>
        </label>

        <label>
          Question set size
          <select id="setSizeSelect">
            <option value="10">Quick (10)</option>
            <option value="20" selected>Normal (20)</option>
            <option value="9999">Full unit (All)</option>
          </select>
        </label>

        <label>
          Auto-advance (after answer)
          <div class="checkrow">
            <input id="autoAdvance" type="checkbox" checked />
            <span>On</span>
          </div>
        </label>
      </div>

      <div class="btnrow">
        <button class="primary" id="startBtn">Start / Restart</button>
        <button id="revealBtn" class="ghost">Reveal answer</button>
        <button id="nextBtn" class="primary" disabled>Next</button>
        <button id="shuffleBtn">Shuffle now</button>
        <button id="resetScoreBtn" class="danger">Reset score</button>
      </div>

      <div class="small" style="margin-top:10px;">
        Classroom-friendly: you can pause to explain; timer is intentionally omitted for the pilot.
      </div>
    </section>

    <section class="panel stage" id="stage">
      <div class="meta">
        <div class="pill" id="metaLeft">—</div>
        <div class="pill" id="metaRight">—</div>
      </div>

      <div class="question" id="qText">Choose Unit and press Start.</div>
      <div class="hint" id="qHint"></div>

      <div class="options" id="options"></div>

      <div class="feedback" id="feedback"></div>

      <div class="footer">
        <div class="score">
          <span class="pill">Correct: <strong id="correctCount">0</strong></span>
          <span class="pill">Wrong: <strong id="wrongCount">0</strong></span>
          <span class="pill">Streak: <strong id="streakCount">0</strong></span>
        </div>
        <div class="small">
          Keyboard: <span class="kbd">R</span> reveal · <span class="kbd">N</span> next · <span class="kbd">S</span> start
        </div>
      </div>
    </section>
  </div>

<script>
const DATA = {
  courseTitle: "English for PT-BR (A1/A2) — Units 1–6",
  units: [
    { unit: 1, title: "I am… (introductions)",
      grammar: [
        q("u1-g1","grammar",1,"What _____ this place?","are|is|am".split("|"),1,"With 'this place' (singular), use 'is'."),
        q("u1-g2","grammar",1,"I _____ Brazilian.","am|is|are".split("|"),0,"With 'I', use 'am'."),
        q("u1-g3","grammar",1,"You _____ from Brazil.","am|are|is".split("|"),1,"With 'you', use 'are'."),
        q("u1-g4","grammar",1,"_____ you a student?","Am|Are|Is".split("|"),1,"Questions: 'Are you…?'"),
        q("u1-g5","grammar",1,"What’s _____ name?","I|you|your".split("|"),2,"Use 'your' for 'you'."),
        q("u1-g6","grammar",1,"This _____ my friend.","are|is|am".split("|"),1,"'This' is singular → 'is'.")
      ],
      vocab: [
        q("u1-v1","vocab",1,"I’m from _____.","Brazil|Brazilian|Brasília".split("|"),0,"Country: Brazil. Nationality: Brazilian."),
        q("u1-v2","vocab",1,"She is _____.","Canada|Canadian|Canadan".split("|"),1,"Nationality adjective: Canadian."),
        q("u1-v3","vocab",1,"Hello! Nice to ____ you.","meet|see|look".split("|"),0,"Common phrase: Nice to meet you."),
        q("u1-v4","vocab",1,"Good _____. (at night)","morning|night|afternoon".split("|"),1,"Greeting: Good night."),
        q("u1-v5","vocab",1,"Spell it: A, B, C… is the _____.","alphabet|address|number".split("|"),0,"Alphabet = letters A–Z.")
      ],
      pron: [
        q("u1-p1","pron",1,"Which word has the **ee** sound (like 'see')?","ship|sheep|shop".split("|"),1,"PT-BR tip: long 'i' sound. sheep ≠ ship.","Hint: ee = longer"),
        q("u1-p2","pron",1,"Same or different? **ship / sheep**","Same|Different|Not sure".split("|"),1,"Brazilians often mix these. They’re different.","Hint: short vs long vowel"),
        q("u1-p3","pron",1,"Which word ends with a consonant sound?","go|see|cat".split("|"),2,"Avoid adding 'i' at the end: 'cati'."),
        q("u1-p4","pron",1,"Where is the stress? **HO-tel**","HO-tel|ho-TEL".split("|"),0,"In English it's usually HO-tel (not ho-TEL).")
      ]
    },
    { unit: 2, title: "Great people",
      grammar: [
        q("u2-g1","grammar",2,"He _____ my brother.","are|is|am".split("|"),1,"He/She/It → is."),
        q("u2-g2","grammar",2,"They _____ friends.","is|are|am".split("|"),1,"They → are."),
        q("u2-g3","grammar",2,"She _____ not from Canada.","is|are|am".split("|"),0,"Negatives: is not / isn’t."),
        q("u2-g4","grammar",2,"_____ they from São Paulo?","Is|Are|Am".split("|"),1,"Questions with 'they': Are they…?"),
        q("u2-g5","grammar",2,"The café is _____ the bank.","next to|next|near to".split("|"),0,"Preposition phrase: next to.")
      ],
      vocab: [
        q("u2-v1","vocab",2,"My mother’s son is my _____.","uncle|brother|cousin".split("|"),1,"Brother = mother’s son."),
        q("u2-v2","vocab",2,"She is very _____. (nice, kind)","friendly|hungry|angry".split("|"),0,"friendly = nice/kind"),
        q("u2-v3","vocab",2,"He’s _____ years old.","twenty|age|old".split("|"),0,"Use a number: twenty."),
        q("u2-v4","vocab",2,"Today is _____. (date)","Monday|January|Brazil".split("|"),1,"Months: January, February…")
      ],
      pron: [
        q("u2-p1","pron",2,"Which word has the **th** sound?","think|sink|thing".split("|"),0,"PT-BR: tongue between teeth. 'think' ≠ 'sink'."),
        q("u2-p2","pron",2,"Same or different? **thin / tin**","Same|Different|Not sure".split("|"),1,"thin has 'th' (no PT equivalent)."),
        q("u2-p3","pron",2,"Which has the **ih** sound (like 'sit')?","seat|sit|set".split("|"),1,"ih = short vowel.")
      ]
    }
  ]
};

function q(id,type,unit,prompt,options,answerIndex,explanation,hint){
  return { id, type, unit, prompt, options, answerIndex, explanation, hint: hint || "" };
}

const els = {
  unitSelect: document.getElementById("unitSelect"),
  modeSelect: document.getElementById("modeSelect"),
  setSizeSelect: document.getElementById("setSizeSelect"),
  autoAdvance: document.getElementById("autoAdvance"),
  startBtn: document.getElementById("startBtn"),
  revealBtn: document.getElementById("revealBtn"),
  nextBtn: document.getElementById("nextBtn"),
  shuffleBtn: document.getElementById("shuffleBtn"),
  resetScoreBtn: document.getElementById("resetScoreBtn"),
  qText: document.getElementById("qText"),
  qHint: document.getElementById("qHint"),
  options: document.getElementById("options"),
  feedback: document.getElementById("feedback"),
  metaLeft: document.getElementById("metaLeft"),
  metaRight: document.getElementById("metaRight"),
  correctCount: document.getElementById("correctCount"),
  wrongCount: document.getElementById("wrongCount"),
  streakCount: document.getElementById("streakCount"),
  datasetInfo: document.getElementById("datasetInfo"),
};

const LS_KEY = "class_drill_state_v1";
const state = {
  sessionQuestions: [],
  index: 0,
  answered: false,
  score: { correct: 0, wrong: 0, streak: 0 },
  config: { unit: 1, mode: "mixed", setSize: 20, autoAdvance: true }
};

init();

function init(){
  DATA.units.forEach(u => {
    const opt = document.createElement("option");
    opt.value = String(u.unit);
    opt.textContent = `Unit ${u.unit}: ${u.title}`;
    els.unitSelect.appendChild(opt);
  });

  try {
    const saved = JSON.parse(localStorage.getItem(LS_KEY) || "null");
    if (saved?.config) Object.assign(state.config, saved.config);
    if (saved?.score) Object.assign(state.score, saved.score);
  } catch {}

  els.unitSelect.value = String(state.config.unit);
  els.modeSelect.value = state.config.mode;
  els.setSizeSelect.value = String(state.config.setSize);
  els.autoAdvance.checked = !!state.config.autoAdvance;

  updateScoreUI();
  updateDatasetInfo();

  els.startBtn.addEventListener("click", startSession);
  els.nextBtn.addEventListener("click", nextQuestion);
  els.revealBtn.addEventListener("click", revealAnswer);

  [els.unitSelect, els.modeSelect, els.setSizeSelect, els.autoAdvance].forEach(el => {
    el.addEventListener("change", () => {
      state.config.unit = parseInt(els.unitSelect.value, 10);
      state.config.mode = els.modeSelect.value;
      state.config.setSize = parseInt(els.setSizeSelect.value, 10);
      state.config.autoAdvance = els.autoAdvance.checked;
      persist();
      updateDatasetInfo();
      setMeta("Ready", "Press Start");
    });
  });

  window.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();
    if (k === "s") startSession();
    if (k === "n") nextQuestion();
    if (k === "r") revealAnswer();
    if (["1","2","3","4"].includes(e.key)) {
      const idx = parseInt(e.key, 10) - 1;
      const btn = els.options.querySelectorAll("button.opt")[idx];
      if (btn) btn.click();
    }
  });

  setMeta("Ready", "Choose Unit + Start");
}

function updateDatasetInfo(){
  const unit = DATA.units.find(u => u.unit === state.config.unit);
  const total = unit.grammar.length + unit.vocab.length + unit.pron.length;
  els.datasetInfo.textContent = `Data: Unit ${unit.unit} (${total} items)`;
}
function persist(){
  localStorage.setItem(LS_KEY, JSON.stringify({ config: state.config, score: state.score }));
}

function startSession(){
  const unitNum = parseInt(els.unitSelect.value, 10);
  const mode = els.modeSelect.value;
  const setSize = parseInt(els.setSizeSelect.value, 10);
  const unit = DATA.units.find(u => u.unit === unitNum);
  if (!unit) return;

  state.config = { unit: unitNum, mode, setSize, autoAdvance: els.autoAdvance.checked };
  persist();

  let pool = [];
  if (mode === "grammar") pool = unit.grammar.slice();
  else if (mode === "vocab") pool = unit.vocab.slice();
  else if (mode === "pron") pool = unit.pron.slice();
  else pool = [...unit.grammar, ...unit.vocab, ...unit.pron];

  shuffle(pool);
  if (setSize !== 9999) pool = pool.slice(0, Math.min(setSize, pool.length));

  state.sessionQuestions = pool;
  state.index = 0;
  state.answered = false;

  els.nextBtn.disabled = true;
  showCurrent();
  flashFeedback("Session started.", "muted");
}

function showCurrent(){
  const q = state.sessionQuestions[state.index];
  if (!q){
    els.qText.textContent = "No questions found for this selection.";
    els.qHint.textContent = "";
    els.options.innerHTML = "";
    setMeta("—", "—");
    return;
  }

  state.answered = false;
  els.nextBtn.disabled = true;
  els.feedback.textContent = "";
  els.options.innerHTML = "";

  els.qText.innerHTML = escapeHtml(q.prompt).replaceAll("**", "<strong>").replaceAll("</strong><strong>", "");
  els.qHint.textContent = q.hint || "";

  q.options.forEach((opt, idx) => {
    const btn = document.createElement("button");
    btn.className = "opt";
    btn.type = "button";
    btn.innerHTML = escapeHtml(opt).replaceAll("**", "<strong>").replaceAll("</strong><strong>", "");
    btn.addEventListener("click", () => chooseOption(idx));
    els.options.appendChild(btn);
  });

  const unit = DATA.units.find(u => u.unit === q.unit);
  setMeta(`Unit ${q.unit}: ${unit?.title || ""}`, `${labelType(q.type)} · ${state.index+1}/${state.sessionQuestions.length}`);
}

function chooseOption(idx){
  if (state.answered) return;
  const q = state.sessionQuestions[state.index];
  state.answered = true;

  const btns = els.options.querySelectorAll("button.opt");
  btns.forEach((b, i) => {
    if (i === q.answerIndex) b.classList.add("correct");
    if (i === idx && i !== q.answerIndex) b.classList.add("wrong");
    b.disabled = true;
  });

  const correct = idx === q.answerIndex;
  if (correct) {
    state.score.correct += 1;
    state.score.streak += 1;
    flashFeedback("✓ Correct", "good");
  } else {
    state.score.wrong += 1;
    state.score.streak = 0;
    flashFeedback(`✗ Wrong — ${q.options[q.answerIndex]}`, "bad");
  }
  updateScoreUI();
  persist();

  els.nextBtn.disabled = false;
  const note = q.explanation ? ` • ${q.explanation}` : "";
  els.feedback.textContent += note;

  if (state.config.autoAdvance) setTimeout(() => nextQuestion(true), 750);
}

function revealAnswer(){
  const q = state.sessionQuestions[state.index];
  if (!q) return;
  const btns = els.options.querySelectorAll("button.opt");
  btns.forEach((b, i) => { if (i === q.answerIndex) b.classList.add("correct"); });
  els.feedback.textContent = `Answer: ${q.options[q.answerIndex]}${q.explanation ? " • " + q.explanation : ""}`;
  els.nextBtn.disabled = false;
}

function nextQuestion(fromAuto=false){
  if (!state.sessionQuestions.length) return;
  state.index += 1;
  if (state.index >= state.sessionQuestions.length){
    els.qText.textContent = "✅ Set complete. Press Start to restart or change Unit/Mode.";
    els.qHint.textContent = "";
    els.options.innerHTML = "";
    els.nextBtn.disabled = true;
    setMeta("Complete", "Change Unit/Mode or Restart");
    if (!fromAuto) flashFeedback("Set complete.", "muted");
    return;
  }
  showCurrent();
}

function updateScoreUI(){
  els.correctCount.textContent = String(state.score.correct);
  els.wrongCount.textContent = String(state.score.wrong);
  els.streakCount.textContent = String(state.score.streak);
}
function setMeta(left,right){
  els.metaLeft.textContent = left;
  els.metaRight.textContent = right;
}

function flashFeedback(text, kind){
  if (kind === "good") els.feedback.style.color = "rgba(0,255,160,.9)";
  else if (kind === "bad") els.feedback.style.color = "rgba(255,80,80,.95)";
  else els.feedback.style.color = "rgba(255,255,255,.7)";
  els.feedback.textContent = text;
  setTimeout(() => { els.feedback.style.color = "rgba(255,255,255,.7)"; }, 900);
}

function labelType(t){
  if (t === "grammar") return "Grammar";
  if (t === "vocab") return "Vocabulary";
  return "Pronunciation";
}

function shuffle(arr){
  for (let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
</script>
</body>
</html>
